# 스파크 SQL

## 1. SQL이란?

- RDBMS 특화 언어.

## 2. 빅데이터와 SQL: 아파치 하이브

- Spark 등장 전에는 하이브가 대세.

## 3. 빅데이터와 SQL: 스파크 SQL

- ANSI-SQL, HiveQL 모두 지원

### 3.1 스파크와 하이브의 관계

- 스파크는 하이브의 메타 스토어를 사용하기에 호환성이 매우 좋음.

## 4. 스파크 SQL 쿼리 실행 방법

### 4.1 스파크 SQL CLI

- 스파크 설치된 환경에서 bash처럼 spark-sql 커맨드가 존재

### 4.2 스파크 프로그래밍 SQL 인터페이스

- `spark.sql` 메서드에서 표현식으로 사용 가능

### 4.3 스파크 SQL 쓰리프트 JDBC/ODBC 서버

- 쓰리프트? -> 쓰리프트는 다양한 언어를 지원하는 RPC 프레임워크 (다양한 인터페이스에 대한 연결을 지원함)

## 5. 카탈로그

- 가장 높은 추상화 단계.

- 테이블, DB, 함수, 뷰에 대한 정보 추상화.

- 스파크 SQL을 사용하는 또 다른 방식의 프로그래밍 인터페이스.

## 6. 테이블

- 테이블은 항상 데이터를 갖고 있다. (spark 2.x 이상에서)

### 6.1 스파크 관리형 테이블

- 관리형 테이블 : 관리형 테이블은 Spark나 Hive와 같은 시스템이 테이블의 데이터와 메타데이터를 모두 관리하는 테이블
- 외부 테이블 : 외부 테이블은 데이터의 위치를 사용자가 직접 지정하며, Spark나 Hive는 해당 위치의 데이터에 대한 메타데이터만 관리

### 6.2 테이블 생성하기

- pass

### 6.3 외부 테이블 생성하기

- pass

### 6.4 테이블에 데이터 삽입하기

- pass

### 6.5 테이블 메타데이터 확인하기

- pass

### 6.6 테이블 메타데이터 갱신하기

- REFRESH table 사용 (모든 캐싱된 항목에 대해서만 갱신)

### 6.7 테이블 삭제하기

- pass

### 6.8 테이블 캐싱하기

- CACHE TABLE

## 7. 뷰

- 여러 테이블에 트랜스포메이션 작업 지정.

- 원하는 데이터에 대해서만 보고 싶을 때 사용한다.

- 테이블 전체 권한 말고, View에 대한 권한만 줘서, 테이블 전체 공개하지 않거나 막을 때 사용.

### 7.1 뷰 생성하기

- pass

### 7.2 뷰 제거하기

- pass

## 8. 데이터 베이스

- 테이블 조직화 도구

### 8.1 데이터베이스 생성하기

- pass

### 8.2 데이터베이스 설정하기

- pass

### 8.3 데이터베이스 제거하기

- pass

## 9. select 구문

- ANSI-SQL 구문 충족

### 9.1 case...when...then 구문

## 10. 고급 주제

### 10.1 복잡한 데이터 타입

- ANSI-SQL과는 거리가 멂.

- 구조체 : MAP에 더 가깝고 중첩 데이터 생성 및 쿼리 방법 제공

- 리스트 : 리스트 vs 배열.

### 10.2 함수

- 사용자 정의 함수: UDF

### 10.3 서브쿼리

- 비상호연관 조건절 서브쿼리

- 상호연관 조건절 서브쿼리: 내부 쿼리에서 외부 범위에 있는 정보 사용 가능함.

- 비상호연관 스칼라 쿼리

## 11. 다양한 기능

- 데이터 압축률

- 배치 사이즈

- 단일 파티션 최대 사이즈 등 등...