# Dataset

- 스파크에서 데이터셋은 자바 빈 객체를 사용해 정의함.

    - `Java Bean Object`란?
        - 자바 프로그래밍 언어에서 재사용 가능한 소프트웨어 컴포넌트를 만들기 위한 표준 디자인 패턴을 따르는 클래스

    - 빈 객체를 사용해 구성한 이유?

        - 스키마 자동 추론: 빈 객체의 속성을 기반으로 스파크는 데이터의 스키마를 자동으로 추론. 이는 데이터 처리 시 컬럼의 이름과 데이터 타입을 명시적으로 관리

        - 타입 안정성(Type Safety): 빈 객체를 사용하면 컴파일 타임에 타입 검사가 이루어져 런타임 오류를 줄일 수 있음. 이는 코드의 안정성과 신뢰성을 향상시킴.

        - 성능 최적화: JavaBean 패턴을 따르면 스파크는 효율적인 직렬화 메커니즘을 사용할 수 있어 네트워크 전송 및 디스크 I/O 성능이 향상

        - 가독성과 유지보수성 향상: 데이터셋을 빈 객체로 정의하면 데이터 구조가 명확해져 코드의 가독성이 높아지고, 팀 간 협업과 유지보수가 용이

- 스파크에서는 DataFrame API를 사용할 때, String or Integer 데이터 타입의 객체를 생성하진 않지만 Row 객체를 변환해 데이터 처리함.

- 도메인별 특정 객체를 효과적으로 지원하고자 `인코더`라는 개념 도입.

    - 런타임 환경에서 도메인에 특화된 객체를 바이너리 구조로 직렬화 

- 앞장에서도 얘기했지만, Dataset API를 사용하지 않고 UDF를 사용하면 파이썬으로 작업할 때 보다 더 느림. (자릿수가 바뀔 정도로)

## 1. Dataset을 사용할 시기

- DataFrame 기능만으로는 수행할 연산을 표현할 수 없는 경우
- 성능저하를 감수하고서라도 타입 안정성을 가진 데이터 타입을 사용하고 싶은 경우 (즉, UDF)


- 케이스 1: 구조적 API 사용이 불가능한 경우

    - 복잡한 비즈니스 로직을 SQL or DataFrame 대신 단일 함수로 인코딩 해야하는 경우.
    
    - 정확도와 방어적 코드를 가장 중요시한다면 성능을 조금 희생하고 Dataset 사용.

- 케이스2: 단일 노드의 워크로드 또는 스파크 워크로드에서 전체 로우에 대한 다양한 트랜스포메이션 재사용할 때

    - Dataset -> 로컬과 분산환경 모두에서 재사용 가능하다는 것.

    - 종종 더 적합한 워크로드 구성을 위해 DataFrame & Dataset을 같이 구성하는 경우가 있는데 성능|타입 안정성 중 하나는 반드시 희생해야하는 상황이 있음.
    
    - DataFrame 기반 ETL 트랜스포메이션 마지막 단계에서 구성.

## 2. Dataset 생성

- 수동이므로 정의할 스키마를 미리 알고 있어야함.

### 2.1 자바: Encoders

### 2.2 스칼라: 케이스 클래스

- 정규 클래스 (regular class)로, 4가지 특징이 있음

    - 불변성
    - 패턴 매칭으로 분해 가능
    - 참조값 대신 클래스 구조 기반 비교
    - 사용하기 쉽고 다루기 편함 (뭘 근거로??)

## 3. 액션

- Dataset & DataFrame: collect, take, count 같은 액션 사용 가능.

## 4. 트랜스포메이션

- Dataset의 트랜스포메이션은 DataFrame과 동일함.

### 4.1 필터링
- filter 메서드 사용

### 4.2 매핑
- map 메서드 사용.
- Dataset의 select 메서드 사용하는 것과 비슷함.
- String 타입의 Dataset 반환.

## 5. 조인

- joinWith 메서드 저공

- co-group(RDD용어)와 거의 유사하고, Dataset 안쪽에 다른 두 개의 중첩된 Dataset으로 구성.

## 6. 그룹화와 집계

- groupBy, rollup, cube 메서드 사용 가능.

    - 단, Dataset 대신 DataFrame 반환하는 메서드들이라 데이터 타입 정보를 잃음.

- 이런 상황에서 그룹화와 집계를 사용하면 (groupByKey) Dataset의 특정 키를 기준으로 그룹화하고 형식화된 Dataset 반환.

- 타입에 대해 유연하게 대응할 수 있지만, JVM 데이터 타입에 최적화할 수 있는 상황을 잃음.