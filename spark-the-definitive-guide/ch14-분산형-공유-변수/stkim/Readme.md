# Chpater 14. 분산형 공유 변수

- 브로드캐스트

    - 여러번 역직렬화를 수행해서 데이터 읽는 것을 방지하고, 각 노드에 공통 데이터를 전달할 목적으로 사용 (말 그대로 분산형 공유 변수)

        - 한 번만 직렬화를 수행한 뒤, 내부적으로 Bit Torrent-like 프로토콜을 사용함 ([링크](https://stackoverflow.com/questions/73918989/how-spark-broadcast-the-data-in-broadcast-join))

            - BitTorrent 프로토콜: 드라이버가 데이터를 처음에는 소수의 워커에게 전송하고, 이후 각 워커가 자신이 받은 데이터를 다른 워커에게 재분배하는 방식으로 네트워크 부하를 감소시킴.

    - 읽기 전용 데이터고, 각 노드에 캐싱됨.

    - 네트워크 I/O 및 중복 데이터 호출 방지.

- 어큐뮬레이터

    - 트랜스포메이션의 내용 갱신할 때 사용 (워커에서는 쓰기만, 드라이버에서는 읽기만)

    - 내고장성 보장 및 드라이버에 효율적인 방식으로 데이터 전달 (효율적이라는 건, 드라이버가 OOM으로 안뻗게한다는 것인가?)

    - Row 단위로 데이터 갱신, 액션이 수행될 때만 갱신된다.

    - 한 번 실행한 Task에 대해서는 데이터 갱신 안됨 (중복 처리 방지 목적)


## 그 외 Spark 관련 공유하고 싶은 것들

- 드라이버와 executor의 역할

    - 드라이버는 철저하게 컨트롤러 & 스케줄링, 액션 실행에 관여.

        - 즉, 직접 연산에 관여는 하지 않지만 집계 (collect, count 등)에 관여한다.

    - executor는 연산, 캐싱, 중간 데이터 저장 목적으로 이용. 노드에서 여러개 존재할 수 있음.

- 스파크에서 사용할 수 있는 기본 입력 데이터 사이즈는 128GB이고, parque, orc 같은 데이터 포맷은 분할해서 읽는 것을 지원하고 있기 때문에 데이터가 클 수록 좋음.

    - 데이터가 클 수록 입력 데이터를 읽는 I/O에 비용을 덜 쓴다.

        - 참고: [링크](https://medium.com/@ssangyu123/spark-input-read-%EC%84%B1%EB%8A%A5-%EC%B5%9C%EC%A0%81%ED%99%94-9d109ada535c)

    - 문제는 Splittable하지 못한 데이터 (gzip...) 와 개행 문자가 없는 데이터 읽을 때 문제가 생김.

        - 참고: [링크](https://medium.com/@ssangyu123/spark-input-read-%EC%84%B1%EB%8A%A5-%EC%B5%9C%EC%A0%81%ED%99%94-9d109ada535c)